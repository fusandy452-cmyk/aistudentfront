<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-zh="AI 留學顧問智能體" data-en="AI Study Abroad Advisor">AI 留學顧問智能體</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // 內嵌配置
        window.__CONFIG__ = {
            API_BASE: 'https://aistudentbackend.zeabur.app/api/v1'
        };

        // 語言切換功能
        let currentLanguage = 'zh';

        function switchLanguage(lang) {
            currentLanguage = lang;
            
            // 更新所有帶有 data-zh 和 data-en 屬性的元素
            document.querySelectorAll('[data-zh][data-en]').forEach(element => {
                element.textContent = element.getAttribute(`data-${lang}`);
            });
            
            // 更新語言按鈕狀態
            document.querySelectorAll('#lang-zh, #lang-en').forEach(btn => {
                btn.classList.remove('bg-white', 'bg-opacity-50');
                btn.classList.add('hover:bg-opacity-75');
            });
            
            const activeBtn = document.getElementById(`lang-${lang}`);
            activeBtn.classList.add('bg-white', 'bg-opacity-50');
            activeBtn.classList.remove('hover:bg-opacity-75');
            
            // 更新頁面語言屬性
            document.documentElement.lang = lang === 'zh' ? 'zh-TW' : 'en';
            
            // 保存語言偏好
            localStorage.setItem('language', lang);
            
            // 更新表單標籤
            updateFormLabels();
        }

        function updateFormLabels() {
            const labels = {
                zh: {
                    'student_name': '學生姓名',
                    'high_school': '就讀學校',
                    'gpa': 'GPA',
                    'intended_major': '目標專業',
                    'target_countries': '目標國家',
                    'budget': '預算',
                    'submit': '提交',
                    'start_chat': '開始與AI顧問對話'
                },
                en: {
                    'student_name': 'Student Name',
                    'high_school': 'High School',
                    'gpa': 'GPA',
                    'intended_major': 'Intended Major',
                    'target_countries': 'Target Countries',
                    'budget': 'Budget',
                    'submit': 'Submit',
                    'start_chat': 'Start Chat with AI Advisor'
                }
            };
            
            Object.keys(labels[currentLanguage]).forEach(key => {
                const elements = document.querySelectorAll(`[data-label="${key}"]`);
                elements.forEach(element => {
                    if (element.tagName === 'LABEL') {
                        element.textContent = labels[currentLanguage][key];
                    } else {
                        element.placeholder = labels[currentLanguage][key];
                    }
                });
            });
        }

        // 頁面載入時初始化語言
        document.addEventListener('DOMContentLoaded', function() {
            const savedLanguage = localStorage.getItem('language') || 'zh';
            switchLanguage(savedLanguage);
            
            // 檢查登入狀態
            checkAuthStatus();
        });

        // 檢查認證狀態
        function checkAuthStatus() {
            fetch('/api/v1/auth/status')
                .then(response => response.json())
                .then(data => {
                    if (data.ok && data.user) {
                        showUserInfo(data.user);
                    } else {
                        showLoginButtons();
                    }
                })
                .catch(error => {
                    console.log('Not authenticated');
                    showLoginButtons();
                });
        }

        function showUserInfo(user) {
            document.getElementById('login-buttons').classList.add('hidden');
            document.getElementById('user-info').classList.remove('hidden');
            document.getElementById('user-name').textContent = user.name;
            if (user.avatar) {
                document.getElementById('user-avatar').src = user.avatar;
            }
        }

        function showLoginButtons() {
            document.getElementById('login-buttons').classList.remove('hidden');
            document.getElementById('user-info').classList.add('hidden');
        }
    </script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.4s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        .chip {
            @apply inline-flex items-center px-3 py-1 rounded-full text-sm font-medium transition-all duration-200;
        }
        
        .chip-unselected {
            @apply bg-gray-100 text-gray-700 hover:bg-gray-200 cursor-pointer;
        }
        
        .chip-selected {
            @apply bg-yellow-400 text-gray-800 hover:bg-yellow-500;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 主頁面 -->
    <div id="home-page" class="min-h-screen">
        <!-- Header -->
        <header class="bg-gradient-to-r from-yellow-400 to-yellow-300 text-gray-800 shadow-lg">
            <div class="container mx-auto px-4 py-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-md">
                            <span class="text-2xl">🎓</span>
                        </div>
                        <div>
                            <h1 class="text-2xl md:text-3xl font-bold" data-zh="AI 留學顧問智能體" data-en="AI Study Abroad Advisor">AI 留學顧問智能體</h1>
                            <p class="text-sm md:text-base text-gray-600" data-zh="專業 • 個性化 • 智能" data-en="Professional • Personalized • Intelligent">專業 • 個性化 • 智能</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- 語言切換 -->
                        <div class="flex items-center space-x-2">
                            <button onclick="switchLanguage('zh')" id="lang-zh" 
                                    class="px-3 py-1 text-sm rounded-lg bg-white bg-opacity-50 hover:bg-opacity-75 transition-all">
                                中文
                            </button>
                            <button onclick="switchLanguage('en')" id="lang-en" 
                                    class="px-3 py-1 text-sm rounded-lg hover:bg-opacity-75 transition-all">
                                English
                            </button>
                        </div>
                        
                        <!-- 登入狀態 -->
                        <div id="auth-section" class="flex items-center space-x-2">
                            <div id="login-buttons" class="flex items-center space-x-2">
                                <a href="/auth/google" 
                                   class="px-4 py-2 bg-white bg-opacity-50 rounded-lg hover:bg-opacity-75 transition-all text-sm font-medium">
                                    <span data-zh="Google 登入" data-en="Login with Google">Google 登入</span>
                                </a>
                                <a href="/auth/line" 
                                   class="px-4 py-2 bg-white bg-opacity-50 rounded-lg hover:bg-opacity-75 transition-all text-sm font-medium">
                                    <span data-zh="LINE 登入" data-en="Login with LINE">LINE 登入</span>
                                </a>
                            </div>
                            <div id="user-info" class="hidden flex items-center space-x-2">
                                <img id="user-avatar" src="" alt="User" class="w-8 h-8 rounded-full">
                                <span id="user-name" class="text-sm font-medium"></span>
                                <a href="/auth/logout" 
                                   class="px-3 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-all text-sm">
                                    <span data-zh="登出" data-en="Logout">登出</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- 主要內容 -->
        <main class="container mx-auto px-4 py-12">
            <!-- 歡迎區域 -->
            <div class="text-center mb-12 fade-in">
                <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6" 
                    data-zh="開啟您的留學之旅" data-en="Start Your Study Abroad Journey">開啟您的留學之旅</h2>
                <p class="text-xl text-gray-600 mb-8 max-w-3xl mx-auto" 
                   data-zh="我們的AI留學顧問將根據您的背景和目標，提供個性化的留學建議和申請指導" 
                   data-en="Our AI study abroad advisor will provide personalized study abroad advice and application guidance based on your background and goals">
                   我們的AI留學顧問將根據您的背景和目標，提供個性化的留學建議和申請指導
                </p>
                
                <!-- 角色選擇卡片 -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto mb-12">
                    <!-- 學生模式 -->
                    <div class="bg-white rounded-2xl shadow-xl p-8 hover:shadow-2xl transition-all duration-300 cursor-pointer" 
                         onclick="startAsStudent()">
                        <div class="text-6xl mb-4">👨‍🎓</div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4" 
                            data-zh="學生模式" data-en="Student Mode">學生模式</h3>
                        <p class="text-gray-600 mb-6" 
                           data-zh="獲得個人化的申請建議、學校推薦和學習規劃" 
                           data-en="Get personalized application advice, school recommendations, and study planning">
                           獲得個人化的申請建議、學校推薦和學習規劃
                        </p>
                        <div class="bg-blue-100 text-blue-800 px-4 py-2 rounded-lg text-sm font-medium">
                            <span data-zh="開始測評" data-en="Start Assessment">開始測評</span>
                        </div>
                    </div>
                    
                    <!-- 家長模式 -->
                    <div class="bg-white rounded-2xl shadow-xl p-8 hover:shadow-2xl transition-all duration-300 cursor-pointer" 
                         onclick="startAsParent()">
                        <div class="text-6xl mb-4">👨‍👩‍👧‍👦</div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4" 
                            data-zh="家長模式" data-en="Parent Mode">家長模式</h3>
                        <p class="text-gray-600 mb-6" 
                           data-zh="了解如何支持孩子的留學規劃，獲取投資回報分析" 
                           data-en="Learn how to support your child's study abroad planning and get investment return analysis">
                           了解如何支持孩子的留學規劃，獲取投資回報分析
                        </p>
                        <div class="bg-green-100 text-green-800 px-4 py-2 rounded-lg text-sm font-medium">
                            <span data-zh="開始測評" data-en="Start Assessment">開始測評</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 功能特色 -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                <div class="text-center p-6 fade-in">
                    <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">🎯</span>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2" 
                        data-zh="個性化建議" data-en="Personalized Advice">個性化建議</h3>
                    <p class="text-gray-600" 
                       data-zh="根據您的成績、興趣和目標提供定制化建議" 
                       data-en="Provide customized advice based on your grades, interests and goals">
                       根據您的成績、興趣和目標提供定制化建議
                    </p>
                </div>
                
                <div class="text-center p-6 fade-in">
                    <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">🏫</span>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2" 
                        data-zh="學校推薦" data-en="School Recommendations">學校推薦</h3>
                    <p class="text-gray-600" 
                       data-zh="基於數據分析的精准學校匹配" 
                       data-en="Accurate school matching based on data analysis">
                       基於數據分析的精准學校匹配
                    </p>
                </div>
                
                <div class="text-center p-6 fade-in">
                    <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">📊</span>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2" 
                        data-zh="投資分析" data-en="Investment Analysis">投資分析</h3>
                    <p class="text-gray-600" 
                       data-zh="詳細的留學投資回報和風險評估" 
                       data-en="Detailed study abroad investment return and risk assessment">
                       詳細的留學投資回報和風險評估
                    </p>
                </div>
            </div>
        </main>
    </div>

    <!-- 測評頁面 -->
    <div id="assessment-page" class="min-h-screen hidden">
        <div class="max-w-2xl mx-auto bg-white min-h-screen">
            <header class="bg-gradient-to-r from-yellow-400 to-yellow-300 text-gray-800 p-6 text-center">
                <button onclick="goBack()" class="absolute left-4 top-6 text-gray-800 hover:text-gray-600 transition-colors">
                    ← <span data-zh="返回" data-en="Back">返回</span>
                </button>
                <h1 class="text-2xl font-bold mb-2" 
                    data-zh="設定您的留學需求" data-en="Set Your Study Abroad Requirements">設定您的留學需求</h1>
                <p class="text-gray-600" 
                   data-zh="讓我們先了解您的基本資訊" data-en="Let us understand your basic information first">
                   讓我們先了解您的基本資訊
                </p>
            </header>

            <main class="p-6">
                <form id="assessment-form" class="space-y-6">
                    <!-- 基本資訊 -->
                    <div class="bg-yellow-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4" 
                            data-zh="基本資訊" data-en="Basic Information">基本資訊</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" 
                                       data-zh="學生姓名" data-en="Student Name">學生姓名</label>
                                <input type="text" id="student_name" required 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                       data-zh="請輸入您的姓名" data-en="Enter your name">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" 
                                       data-zh="就讀學校" data-en="High School">就讀學校</label>
                                <input type="text" id="high_school" required 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                       data-zh="請輸入學校名稱" data-en="Enter school name">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" 
                                       data-zh="GPA" data-en="GPA">GPA</label>
                                <input type="number" id="gpa" min="0" max="4" step="0.1" required 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                       data-zh="例如：3.7" data-en="e.g.: 3.7">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" 
                                       data-zh="目標專業" data-en="Intended Major">目標專業</label>
                                <input type="text" id="intended_major" required 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                       data-zh="例如：Computer Science" data-en="e.g.: Computer Science">
                            </div>
                        </div>
                    </div>

                    <!-- 目標國家 -->
                    <div class="bg-blue-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4" 
                            data-zh="目標國家" data-en="Target Countries">目標國家</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="countries" value="us" class="rounded">
                                <span data-zh="美國" data-en="USA">美國</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="countries" value="uk" class="rounded">
                                <span data-zh="英國" data-en="UK">英國</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="countries" value="ca" class="rounded">
                                <span data-zh="加拿大" data-en="Canada">加拿大</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="countries" value="au" class="rounded">
                                <span data-zh="澳洲" data-en="Australia">澳洲</span>
                            </label>
                        </div>
                    </div>

                    <!-- 預算 -->
                    <div class="bg-green-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4" 
                            data-zh="年度預算" data-en="Annual Budget">年度預算</h3>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" 
                                   data-zh="預算 (美元)" data-en="Budget (USD)">預算 (美元)</label>
                            <input type="number" id="budget" min="0" required 
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                   data-zh="例如：50000" data-en="e.g.: 50000">
                        </div>
                    </div>

                    <button type="submit" 
                            class="w-full bg-yellow-400 text-gray-800 py-4 px-6 rounded-lg font-medium hover:bg-yellow-500 transition-colors text-lg">
                        <span data-zh="開始與AI顧問對話" data-en="Start Chat with AI Advisor">開始與AI顧問對話</span>
                    </button>
                </form>
            </main>
        </div>
    </div>

    <script>
        // 頁面導航
        function startAsStudent() {
            document.getElementById('home-page').classList.add('hidden');
            document.getElementById('assessment-page').classList.remove('hidden');
            document.getElementById('assessment-page').dataset.role = 'student';
        }

        function startAsParent() {
            document.getElementById('home-page').classList.add('hidden');
            document.getElementById('assessment-page').classList.remove('hidden');
            document.getElementById('assessment-page').dataset.role = 'parent';
        }

        function goBack() {
            document.getElementById('home-page').classList.remove('hidden');
            document.getElementById('assessment-page').classList.add('hidden');
        }

        // 表單提交
        document.getElementById('assessment-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            const countries = Array.from(document.querySelectorAll('input[name="countries"]:checked')).map(cb => cb.value);
            
            if (countries.length === 0) {
                alert(currentLanguage === 'zh' ? '請至少選擇一個目標國家' : 'Please select at least one target country');
                return;
            }
            
            const profileData = {
                ...data,
                countries: countries,
                role: document.getElementById('assessment-page').dataset.role || 'student'
            };
            
            // 保存到 localStorage 並跳轉
            localStorage.setItem('profileData', JSON.stringify(profileData));
            
            if (profileData.role === 'student') {
                window.location.href = '/student';
            } else {
                window.location.href = '/parent';
            }
        });

        // 更新輸入框 placeholder
        function updateFormPlaceholders() {
            const placeholders = {
                zh: {
                    'student_name': '請輸入您的姓名',
                    'high_school': '請輸入學校名稱',
                    'gpa': '例如：3.7',
                    'intended_major': '例如：Computer Science',
                    'budget': '例如：50000'
                },
                en: {
                    'student_name': 'Enter your name',
                    'high_school': 'Enter school name',
                    'gpa': 'e.g.: 3.7',
                    'intended_major': 'e.g.: Computer Science',
                    'budget': 'e.g.: 50000'
                }
            };
            
            Object.keys(placeholders[currentLanguage]).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.placeholder = placeholders[currentLanguage][key];
                }
            });
        }

        // 重寫 switchLanguage 函數以包含表單更新
        const originalSwitchLanguage = switchLanguage;
        switchLanguage = function(lang) {
            originalSwitchLanguage(lang);
            updateFormPlaceholders();
        };
    </script>
</body>
</html>
