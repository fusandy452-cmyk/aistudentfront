<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ç•™å­¸é¡§å•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // å…§åµŒé…ç½®
        window.__CONFIG__ = {
            API_BASE: 'https://aistudentbackend.zeabur.app/api/v1'
        };
    </script>
    <style>
        /* è‡ªå®šç¾©æ¨£å¼ */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hidden { display: none; }
        .block { display: block; }
        
        .message-bubble {
            @apply max-w-xs sm:max-w-sm md:max-w-md lg:max-w-lg px-4 py-2 rounded-2xl;
        }
        
        .message-user {
            @apply bg-yellow-400 text-gray-800 ml-auto;
        }
        
        .message-ai {
            @apply bg-yellow-50 text-gray-800 mr-auto border border-yellow-200;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased text-gray-800">
    <!-- ç™»å…¥é é¢ -->
    <div id="login-page" class="min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-yellow-100 to-blue-100">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-md w-full text-center fade-in">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-4" data-zh="AI ç•™å­¸é¡§å•" data-en="AI Study Abroad Advisor">AI ç•™å­¸é¡§å•</h1>
            <p class="text-lg text-gray-600 mb-8" data-zh="æ‚¨çš„å€‹äººåŒ–ç•™å­¸è¦åŠƒå°ˆå®¶" data-en="Your Personalized Study Abroad Planning Expert">æ‚¨çš„å€‹äººåŒ–ç•™å­¸è¦åŠƒå°ˆå®¶</p>
            
            <div id="auth-section" class="mb-6">
                <div id="user-info" class="hidden mb-4">
                    <img id="user-avatar" class="w-16 h-16 rounded-full mx-auto mb-2" src="" alt="User Avatar">
                    <p class="text-xl font-semibold">æ­¡è¿ï¼Œ<span id="user-name"></span>!</p>
                    <button onclick="logout()" class="mt-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">ç™»å‡º</button>
                </div>
                <div id="login-buttons">
                    <p class="text-gray-700 mb-4" data-zh="è«‹ç™»å…¥ä»¥ç¹¼çºŒ" data-en="Please login to continue">è«‹ç™»å…¥ä»¥ç¹¼çºŒ</p>
                    <button onclick="skipLogin()" class="w-full flex items-center justify-center px-4 py-3 mb-3 bg-yellow-400 text-gray-800 rounded-lg hover:bg-yellow-500 transition-colors font-medium shadow-md">
                        <span data-zh="è·³éç™»å…¥ï¼Œç›´æ¥é–‹å§‹" data-en="Skip login, start directly">è·³éç™»å…¥ï¼Œç›´æ¥é–‹å§‹</span>
                    </button>
                    <button onclick="loginWithGoogle()" class="w-full flex items-center justify-center px-4 py-3 mb-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium shadow-md">
                        <img src="https://img.icons8.com/color/24/000000/google-logo.png" alt="Google" class="w-5 h-5 mr-2">
                        <span data-zh="ä½¿ç”¨ Google ç™»å…¥" data-en="Login with Google">ä½¿ç”¨ Google ç™»å…¥</span>
                    </button>
                    <button onclick="loginWithLine()" class="w-full flex items-center justify-center px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium shadow-md">
                        <img src="https://img.icons8.com/color/24/000000/line-me.png" alt="LINE" class="w-5 h-5 mr-2">
                        <span data-zh="ä½¿ç”¨ LINE ç™»å…¥" data-en="Login with LINE">ä½¿ç”¨ LINE ç™»å…¥</span>
                    </button>
                </div>
            </div>

            <button id="start-intake-btn" 
                    class="w-full bg-yellow-400 text-gray-800 py-3 px-6 rounded-lg font-medium hover:bg-yellow-500 transition-colors duration-200 text-lg shadow-lg"
                    data-zh="é–‹å§‹æ¸¬è©•" data-en="Start Assessment">
                é–‹å§‹æ¸¬è©•
            </button>

            <!-- èªè¨€åˆ‡æ› -->
            <div class="mt-6 flex justify-center space-x-4">
                <button onclick="switchLanguage('zh')" id="lang-switch-zh" 
                        class="px-4 py-2 text-sm rounded-lg bg-blue-500 text-white transition-colors">
                    ä¸­æ–‡
                </button>
                <button onclick="switchLanguage('en')" id="lang-switch-en" 
                        class="px-4 py-2 text-sm rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors">
                    English
                </button>
            </div>
        </div>
    </div>

    <!-- è¨­å®šé é¢ -->
    <div id="setup-page" class="min-h-screen hidden">
        <div class="max-w-2xl mx-auto bg-white min-h-screen">
            <header class="bg-gradient-to-r from-yellow-400 to-yellow-300 text-gray-800 p-4 sm:p-6 text-center relative">
                <button id="back-to-home" class="absolute left-2 sm:left-4 top-4 sm:top-6 text-gray-800 hover:text-gray-600 transition-colors text-sm sm:text-base">
                    <span data-zh="â† è¿”å›é¦–é " data-en="â† Back to Home">â† è¿”å›é¦–é </span>
                </button>
                <h1 class="text-lg sm:text-xl lg:text-2xl font-bold mb-1 sm:mb-2" data-zh="è¨­å®šæ‚¨çš„ç•™å­¸éœ€æ±‚" data-en="Set Your Study Abroad Requirements">è¨­å®šæ‚¨çš„ç•™å­¸éœ€æ±‚</h1>
                <p class="text-gray-600 text-sm sm:text-base" data-zh="è®“æˆ‘å€‘å…ˆäº†è§£æ‚¨çš„åŸºæœ¬è³‡è¨Š" data-en="Let us understand your basic information first">è®“æˆ‘å€‘å…ˆäº†è§£æ‚¨çš„åŸºæœ¬è³‡è¨Š</p>
            </header>

            <!-- Setup Form -->
            <main class="p-6">
                <form id="setup-form" class="space-y-6">
                    <!-- å€‹äººåŸºæœ¬è³‡è¨Š -->
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <div class="flex items-center mb-2">
                                <span class="w-6 h-6 bg-yellow-400 text-gray-800 rounded-full flex items-center justify-center text-sm mr-2">1</span>
                                å€‹äººåŸºæœ¬è³‡è¨Š
                            </div>
                        </h3>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å­¸ç”Ÿå§“å *</label>
                            <input type="text" id="student_name" name="student_name" required 
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜ / David Wang">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å­¸ç”Ÿé›»å­éƒµä»¶ *</label>
                            <input type="email" id="student_email" name="student_email" required 
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                placeholder="ä¾‹å¦‚ï¼šdavid.wang@example.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">åœ‹ç± *</label>
                            <input type="text" id="citizenship" name="citizenship" required 
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                placeholder="ä¾‹å¦‚ï¼šå°ç£ / Taiwan">
                        </div>
                    </div>

                    <!-- å­¸è¡“èƒŒæ™¯ -->
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <div class="flex items-center mb-2">
                                <span class="w-6 h-6 bg-yellow-400 text-gray-800 rounded-full flex items-center justify-center text-sm mr-2">2</span>
                                å­¸è¡“èƒŒæ™¯
                            </div>
                        </h3>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">GPA (æ»¿åˆ†4.0) *</label>
                            <input type="number" id="gpa" name="gpa" step="0.1" min="0" max="4" required 
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                placeholder="ä¾‹å¦‚ï¼š3.8">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ç›®æ¨™å­¸ä½ *</label>
                            <select id="degree" name="degree" required 
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="bachelor">å­¸å£«</option>
                                <option value="master">ç¢©å£«</option>
                                <option value="phd">åšå£«</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ç›®æ¨™åœ‹å®¶ *</label>
                            <div class="flex flex-wrap gap-2">
                                <label class="flex items-center">
                                    <input type="checkbox" name="countries" value="us" class="mr-2">
                                    ç¾åœ‹
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="countries" value="uk" class="mr-2">
                                    è‹±åœ‹
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="countries" value="ca" class="mr-2">
                                    åŠ æ‹¿å¤§
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- é ç®—å’Œæ™‚é–“ -->
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <div class="flex items-center mb-2">
                                <span class="w-6 h-6 bg-yellow-400 text-gray-800 rounded-full flex items-center justify-center text-sm mr-2">3</span>
                                é ç®—å’Œæ™‚é–“
                            </div>
                        </h3>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é ç®— (æ¯å¹´å­¸è²»+ç”Ÿæ´»è²»ï¼Œå–®ä½ï¼šç¾å…ƒ) *</label>
                            <input type="number" id="budget" name="budget" required 
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                placeholder="ä¾‹å¦‚ï¼š50000">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ç›®æ¨™å…¥å­¸æ™‚é–“ *</label>
                            <input type="text" id="target_intake" name="target_intake" required 
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                placeholder="ä¾‹å¦‚ï¼š2026å¹´ç§‹å­£">
                        </div>
                    </div>

                    <!-- è§’è‰²é¸æ“‡ -->
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <div class="flex items-center mb-2">
                                <span class="w-6 h-6 bg-yellow-400 text-gray-800 rounded-full flex items-center justify-center text-sm mr-2">4</span>
                                é¸æ“‡æ‚¨çš„èº«ä»½
                            </div>
                        </h3>
                        <div class="flex space-x-4">
                            <button type="button" onclick="selectRole('student')" id="role-student" 
                                    class="flex-1 px-6 py-3 bg-blue-500 text-white rounded-lg font-medium transition-colors">
                                <span data-zh="ğŸ‘¨â€ğŸ“ æˆ‘æ˜¯å­¸ç”Ÿ" data-en="ğŸ‘¨â€ğŸ“ I am a Student">ğŸ‘¨â€ğŸ“ æˆ‘æ˜¯å­¸ç”Ÿ</span>
                            </button>
                            <button type="button" onclick="selectRole('parent')" id="role-parent" 
                                    class="flex-1 px-6 py-3 bg-gray-300 text-gray-700 rounded-lg font-medium transition-colors hover:bg-gray-400">
                                <span data-zh="ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ æˆ‘æ˜¯å®¶é•·" data-en="ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ I am a Parent">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ æˆ‘æ˜¯å®¶é•·</span>
                            </button>
                        </div>
                    </div>

                    <button type="submit" 
                            class="w-full bg-yellow-400 text-gray-800 py-3 px-6 rounded-lg font-medium hover:bg-yellow-500 transition-colors duration-200 text-lg shadow-lg">
                        é–‹å§‹èˆ‡AIé¡§å•å°è©±
                    </button>
                </form>
            </main>
        </div>
    </div>

    <!-- èŠå¤©é é¢ -->
    <div id="chat-page" class="min-h-screen hidden">
        <div class="max-w-4xl mx-auto bg-white min-h-screen flex flex-col">
            <header class="bg-gradient-to-r from-yellow-400 to-yellow-300 text-gray-800 p-4 text-center relative">
                <button id="back-to-setup" class="absolute left-4 top-4 text-gray-800 hover:text-gray-600 transition-colors">
                    â† é‡æ–°è¨­å®š
                </button>
                <h1 class="text-xl font-bold">AI ç•™å­¸é¡§å•</h1>
                <p class="text-sm">æ­£åœ¨ç‚ºæ‚¨æä¾›å°ˆæ¥­å»ºè­°</p>
                <div class="flex items-center justify-center mt-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                    <span class="text-sm">åœ¨ç·š</span>
                </div>
            </header>

            <main class="flex-1 p-4 overflow-y-auto" id="chat-container">
                <div class="space-y-4">
                    <div class="message-bubble message-ai">
                        <p>æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„AIç•™å­¸é¡§å•ã€‚æˆ‘å·²ç¶“äº†è§£äº†æ‚¨çš„åŸºæœ¬è³‡è¨Šï¼Œç¾åœ¨è®“æˆ‘å€‘æ·±å…¥è¨è«–æ‚¨çš„ç•™å­¸è¨ˆåŠƒå§ï¼</p>
                        <p class="mt-2">æ‚¨å¯ä»¥å•æˆ‘ä»»ä½•é—œæ–¼ç•™å­¸çš„å•é¡Œï¼Œæ¯”å¦‚ï¼š</p>
                        <ul class="mt-2 list-disc list-inside text-sm">
                            <li>æ¨è–¦é©åˆçš„å­¸æ ¡å’Œå°ˆæ¥­</li>
                            <li>ç”³è«‹æµç¨‹å’Œæ™‚é–“è¦åŠƒ</li>
                            <li>çå­¸é‡‘ç”³è«‹å»ºè­°</li>
                            <li>ç°½è­‰å’Œä½å®¿è³‡è¨Š</li>
                        </ul>
                    </div>
                </div>
            </main>

            <footer class="p-4 border-t border-gray-200">
                <div class="flex space-x-2">
                    <input type="text" id="message-input" 
                           class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                           placeholder="è«‹è¼¸å…¥æ‚¨çš„å•é¡Œ...">
                    <button id="send-btn" 
                            class="px-6 py-3 bg-yellow-400 text-gray-800 rounded-lg font-medium hover:bg-yellow-500 transition-colors">
                        ç™¼é€
                    </button>
                </div>
                <p class="text-xs text-gray-500 mt-2 text-center">æŒ‰ Enter ç™¼é€</p>
            </footer>
        </div>
    </div>

    <script>
        // å…¨å±€è®Šé‡
        let currentRole = 'student';
        let currentLanguage = 'zh';
        let profileId = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
            checkAuthStatus();
            
            // ç¶å®šäº‹ä»¶
            document.getElementById('start-intake-btn').addEventListener('click', showSetupPage);
            document.getElementById('back-to-home').addEventListener('click', showLoginPage);
            document.getElementById('back-to-setup').addEventListener('click', showSetupPage);
            document.getElementById('setup-form').addEventListener('submit', handleSetupSubmit);
            document.getElementById('send-btn').addEventListener('click', sendMessage);
            document.getElementById('message-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        });

        // æª¢æŸ¥èªè­‰ç‹€æ…‹
        async function checkAuthStatus() {
            try {
                const response = await fetch(`${window.__CONFIG__.API_BASE}/auth/status`);
                const data = await response.json();
                
                if (data.ok && data.user) {
                    showUserInfo(data.user);
                } else {
                    showLoginButtons();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                showLoginButtons();
            }
        }

        // é¡¯ç¤ºç”¨æˆ¶è³‡è¨Š
        function showUserInfo(user) {
            document.getElementById('user-info').classList.remove('hidden');
            document.getElementById('login-buttons').classList.add('hidden');
            document.getElementById('user-name').textContent = user.name;
            if (user.avatar) {
                document.getElementById('user-avatar').src = user.avatar;
            }
        }

        // é¡¯ç¤ºç™»å…¥æŒ‰éˆ•
        function showLoginButtons() {
            document.getElementById('user-info').classList.add('hidden');
            document.getElementById('login-buttons').classList.remove('hidden');
        }

        // ç™»å…¥åŠŸèƒ½
        function loginWithGoogle() {
            alert(currentLanguage === 'en' ? 'Login is temporarily unavailable. Please click "Skip login, start directly".' : 'ç™»å…¥åŠŸèƒ½æš«æ™‚ä¸å¯ç”¨ï¼Œè«‹é»ã€Œè·³éç™»å…¥ï¼Œç›´æ¥é–‹å§‹ã€');
        }

        function loginWithLine() {
            alert(currentLanguage === 'en' ? 'Login is temporarily unavailable. Please click "Skip login, start directly".' : 'ç™»å…¥åŠŸèƒ½æš«æ™‚ä¸å¯ç”¨ï¼Œè«‹é»ã€Œè·³éç™»å…¥ï¼Œç›´æ¥é–‹å§‹ã€');
        }

        function logout() {
            window.location.href = `${window.__CONFIG__.API_BASE.replace('/api/v1', '')}/auth/logout`;
        }

        // èªè¨€åˆ‡æ›
        function switchLanguage(lang) {
            currentLanguage = lang;
            // æ›´æ–°æ‰€æœ‰å…·å‚™ data-zh / data-en çš„å…ƒç´ 
            const elements = document.querySelectorAll('[data-zh]');
            elements.forEach(el => {
                const text = el.getAttribute(`data-${currentLanguage}`);
                if (text) el.textContent = text;
            });
            // æ›´æ–°èªè¨€åˆ‡æ›æŒ‰éˆ•æ¨£å¼
            document.getElementById('lang-switch-zh').classList.toggle('bg-blue-500', lang === 'zh');
            document.getElementById('lang-switch-zh').classList.toggle('bg-gray-200', lang !== 'zh');
            document.getElementById('lang-switch-zh').classList.toggle('text-white', lang === 'zh');
            document.getElementById('lang-switch-zh').classList.toggle('text-gray-700', lang !== 'zh');
            document.getElementById('lang-switch-en').classList.toggle('bg-blue-500', lang === 'en');
            document.getElementById('lang-switch-en').classList.toggle('bg-gray-200', lang !== 'en');
            document.getElementById('lang-switch-en').classList.toggle('text-white', lang === 'en');
            document.getElementById('lang-switch-en').classList.toggle('text-gray-700', lang !== 'en');
        }

        // è§’è‰²é¸æ“‡
        function selectRole(role) {
            currentRole = role;
            document.getElementById('role-student').classList.toggle('bg-blue-500', role === 'student');
            document.getElementById('role-student').classList.toggle('bg-gray-300', role !== 'student');
            document.getElementById('role-parent').classList.toggle('bg-blue-500', role === 'parent');
            document.getElementById('role-parent').classList.toggle('bg-gray-300', role !== 'parent');
        }

        // é é¢åˆ‡æ›
        function showLoginPage() {
            document.getElementById('login-page').classList.remove('hidden');
            document.getElementById('setup-page').classList.add('hidden');
            document.getElementById('chat-page').classList.add('hidden');
        }

        function showSetupPage() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('setup-page').classList.remove('hidden');
            document.getElementById('chat-page').classList.add('hidden');
        }

        function showChatPage() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('setup-page').classList.add('hidden');
            document.getElementById('chat-page').classList.remove('hidden');
        }

        // è™•ç†è¨­å®šæäº¤
        async function handleSetupSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                student_name: formData.get('student_name'),
                student_email: formData.get('student_email'),
                citizenship: formData.get('citizenship'),
                gpa: parseFloat(formData.get('gpa')),
                degree: formData.get('degree'),
                countries: Array.from(document.querySelectorAll('input[name="countries"]:checked')).map(cb => cb.value),
                budget: parseInt(formData.get('budget')),
                target_intake: formData.get('target_intake'),
                user_role: currentRole
            };

            try {
                const response = await fetch(`${window.__CONFIG__.API_BASE}/intake`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                if (result.ok) {
                    profileId = result.data.profile_id;
                    showChatPage();
                } else {
                    alert('æäº¤å¤±æ•—ï¼š' + result.error);
                }
            } catch (error) {
                console.error('Setup submission failed:', error);
                alert('æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥');
            }
        }

        // ç™¼é€æ¶ˆæ¯
        async function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            
            if (!message) return;

            // æ·»åŠ ç”¨æˆ¶æ¶ˆæ¯åˆ°èŠå¤©
            addMessage(message, 'user');
            input.value = '';

            try {
                const response = await fetch(`${window.__CONFIG__.API_BASE}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        profile_id: profileId,
                        message: message,
                        user_role: currentRole
                    })
                });

                const result = await response.json();
                
                if (result.ok) {
                    addMessage(result.data.response, 'ai');
                } else {
                    addMessage('æŠ±æ­‰ï¼Œæˆ‘ç„¡æ³•è™•ç†æ‚¨çš„è«‹æ±‚ã€‚è«‹ç¨å¾Œå†è©¦ã€‚', 'ai');
                }
            } catch (error) {
                console.error('Chat failed:', error);
                addMessage('æŠ±æ­‰ï¼Œç¶²è·¯é€£æ¥å‡ºç¾å•é¡Œã€‚è«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯é€£æ¥ã€‚', 'ai');
            }
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©
        function addMessage(message, sender) {
            const chatContainer = document.getElementById('chat-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-bubble ${sender === 'user' ? 'message-user' : 'message-ai'}`;
            messageDiv.innerHTML = `<p>${message}</p>`;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
    </script>
</body>
</html>
