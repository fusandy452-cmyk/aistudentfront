<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ç•™å­¸é¡§å•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        // å…§åµŒé…ç½®
        window.__CONFIG__ = {
            API_BASE: 'https://aistudentbackend.zeabur.app/api/v1',
            // æš«æ™‚ä½¿ç”¨æ¸¬è©¦æ¨¡å¼ï¼Œè·³éå¾Œç«¯é©—è­‰
            TEST_MODE: true
        };
    </script>
    <style>
        /* è‡ªå®šç¾©æ¨£å¼ */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hidden { display: none; }
        .block { display: block; }
        
        .message-bubble {
            @apply max-w-xs sm:max-w-sm md:max-w-md lg:max-w-lg px-4 py-3 rounded-2xl relative shadow-sm;
            word-wrap: break-word;
        }
        
        .message-user {
            @apply bg-gradient-to-r from-yellow-400 to-yellow-500 text-gray-800 ml-auto;
            margin-left: auto;
            margin-right: 0;
        }
        
        .message-user::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: -8px;
            width: 0;
            height: 0;
            border: 8px solid transparent;
            border-left-color: #fbbf24;
            border-bottom: none;
            border-right: none;
        }
        
        .message-ai {
            @apply bg-white text-gray-800 mr-auto border border-gray-200;
            margin-left: 0;
            margin-right: auto;
        }
        
        .message-ai::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: -8px;
            width: 0;
            height: 0;
            border: 8px solid transparent;
            border-right-color: white;
            border-bottom: none;
            border-left: none;
        }
        
        .message-ai::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: -9px;
            width: 0;
            height: 0;
            border: 8px solid transparent;
            border-right-color: #e5e7eb;
            border-bottom: none;
            border-left: none;
        }
        
        .message-time {
            @apply text-xs text-gray-500 mt-1;
        }
        
        .message-avatar {
            @apply w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold text-white;
        }
        
        .avatar-ai {
            @apply bg-gradient-to-r from-blue-500 to-blue-600;
        }
        
        .avatar-user {
            @apply bg-gradient-to-r from-yellow-500 to-yellow-600;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased text-gray-800">
    <!-- ç™»å…¥é é¢ -->
    <div id="login-page" class="min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-yellow-100 to-blue-100">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-md w-full text-center fade-in">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-4" data-zh="AI ç•™å­¸é¡§å•" data-en="AI Study Abroad Advisor">AI ç•™å­¸é¡§å•</h1>
            <p class="text-lg text-gray-600 mb-8" data-zh="æ‚¨çš„å€‹äººåŒ–ç•™å­¸è¦åŠƒå°ˆå®¶" data-en="Your Personalized Study Abroad Planning Expert">æ‚¨çš„å€‹äººåŒ–ç•™å­¸è¦åŠƒå°ˆå®¶</p>
            
            <div id="auth-section" class="mb-6">
                <div id="user-info" class="hidden mb-4">
                    <img id="user-avatar" class="w-16 h-16 rounded-full mx-auto mb-2" src="" alt="User Avatar">
                    <p class="text-xl font-semibold">æ­¡è¿ï¼Œ<span id="user-name"></span>!</p>
                    <button onclick="logout()" class="mt-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">ç™»å‡º</button>
                </div>
                <div id="login-buttons">
                    <p class="text-gray-700 mb-4" data-zh="è«‹ç™»å…¥ä»¥ç¹¼çºŒ" data-en="Please login to continue">è«‹ç™»å…¥ä»¥ç¹¼çºŒ</p>
                    <button onclick="skipLogin()" class="w-full flex items-center justify-center px-4 py-3 mb-3 bg-yellow-400 text-gray-800 rounded-lg hover:bg-yellow-500 transition-colors font-medium shadow-md">
                        <span data-zh="è·³éç™»å…¥ï¼Œç›´æ¥é–‹å§‹" data-en="Skip login, start directly">è·³éç™»å…¥ï¼Œç›´æ¥é–‹å§‹</span>
                    </button>
                    <button onclick="loginWithGoogle()" id="google-login-btn" class="w-full flex items-center justify-center px-4 py-3 mb-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium shadow-md">
                        <img src="https://img.icons8.com/color/24/000000/google-logo.png" alt="Google" class="w-5 h-5 mr-2">
                        <span data-zh="ä½¿ç”¨ Google ç™»å…¥" data-en="Login with Google">ä½¿ç”¨ Google ç™»å…¥</span>
                    </button>
                    <button onclick="loginWithLine()" class="w-full flex items-center justify-center px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium shadow-md">
                        <img src="https://img.icons8.com/color/24/000000/line-me.png" alt="LINE" class="w-5 h-5 mr-2">
                        <span data-zh="ä½¿ç”¨ LINE ç™»å…¥" data-en="Login with LINE">ä½¿ç”¨ LINE ç™»å…¥</span>
                    </button>
                </div>
            </div>


            <!-- èªè¨€åˆ‡æ› -->
            <div class="mt-6 flex justify-center space-x-4">
                <button onclick="switchLanguage('zh')" id="lang-switch-zh" 
                        class="px-4 py-2 text-sm rounded-lg bg-blue-500 text-white transition-colors">
                    ä¸­æ–‡
                </button>
                <button onclick="switchLanguage('en')" id="lang-switch-en" 
                        class="px-4 py-2 text-sm rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors">
                    English
                </button>
            </div>
        </div>
    </div>

    <!-- è¨­å®šé é¢ -->
    <div id="setup-page" class="min-h-screen hidden">
        <div class="max-w-2xl mx-auto bg-white min-h-screen">
            <header class="bg-gradient-to-r from-yellow-400 to-yellow-300 text-gray-800 p-4 sm:p-6 relative">
                <button id="back-to-home" class="absolute left-2 sm:left-4 top-4 sm:top-6 text-gray-800 hover:text-gray-600 transition-colors text-sm sm:text-base z-10">
                    <span data-zh="â† Back" data-en="â† Back">â† Back</span>
                </button>
                <div class="text-center px-12 sm:px-0">
                    <h1 class="text-base sm:text-xl lg:text-2xl font-bold mb-1 sm:mb-2 leading-tight" data-zh="è¨­å®šæ‚¨çš„ç•™å­¸éœ€æ±‚" data-en="Set Your Study Abroad Requirements">è¨­å®šæ‚¨çš„ç•™å­¸éœ€æ±‚</h1>
                    <p class="text-gray-600 text-xs sm:text-base leading-tight" data-zh="è®“æˆ‘å€‘å…ˆäº†è§£æ‚¨çš„åŸºæœ¬è³‡è¨Š" data-en="Let us understand your basic information first">è®“æˆ‘å€‘å…ˆäº†è§£æ‚¨çš„åŸºæœ¬è³‡è¨Š</p>
                </div>
            </header>

            <!-- Setup Form -->
            <main class="p-6">
                <form id="setup-form" class="space-y-6">
                    <!-- å€‹äººåŸºæœ¬è³‡è¨Š -->
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <div class="flex items-center mb-2">
                                <span class="w-6 h-6 bg-yellow-400 text-gray-800 rounded-full flex items-center justify-center text-sm mr-2">1</span>
                                <span data-zh="å€‹äººåŸºæœ¬è³‡è¨Š" data-en="Personal Information">å€‹äººåŸºæœ¬è³‡è¨Š</span>
                            </div>
                        </h3>
                        <div id="student-fields" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-zh="å­¸ç”Ÿå§“å *" data-en="Student Name *">å­¸ç”Ÿå§“å *</label>
                                <input type="text" id="student_name" name="student_name" required 
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                    data-zh-ph="ä¾‹å¦‚ï¼šç‹å°æ˜" data-en-ph="e.g., David Wang" placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-zh="å­¸ç”Ÿé›»å­éƒµä»¶ *" data-en="Student Email *">å­¸ç”Ÿé›»å­éƒµä»¶ *</label>
                                <input type="email" id="student_email" name="student_email" required 
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                    data-zh-ph="ä¾‹å¦‚ï¼šdavid@example.com" data-en-ph="e.g., david@example.com" placeholder="ä¾‹å¦‚ï¼šdavid@example.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-zh="åœ‹ç± *" data-en="Citizenship *">åœ‹ç± *</label>
                                <input type="text" id="citizenship" name="citizenship" required 
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                    data-zh-ph="ä¾‹å¦‚ï¼šå°ç£" data-en-ph="e.g., Taiwan" placeholder="ä¾‹å¦‚ï¼šå°ç£">
                            </div>
                        </div>
                        <div id="parent-fields" class="space-y-4 hidden">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-zh="å®¶é•·å§“å *" data-en="Parent Name *">å®¶é•·å§“å *</label>
                                <input type="text" id="parent_name" name="parent_name"
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                    data-zh-ph="ä¾‹å¦‚ï¼šç‹åª½åª½" data-en-ph="e.g., Alice Wang" placeholder="ä¾‹å¦‚ï¼šç‹åª½åª½">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-zh="å®¶é•·é›»å­éƒµä»¶ *" data-en="Parent Email *">å®¶é•·é›»å­éƒµä»¶ *</label>
                                <input type="email" id="parent_email" name="parent_email"
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                    data-zh-ph="ä¾‹å¦‚ï¼šparent@example.com" data-en-ph="e.g., parent@example.com" placeholder="ä¾‹å¦‚ï¼šparent@example.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-zh="èˆ‡å­¸ç”Ÿé—œä¿‚ *" data-en="Relationship to Student *">èˆ‡å­¸ç”Ÿé—œä¿‚ *</label>
                                <input type="text" id="relationship" name="relationship"
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                    data-zh-ph="ä¾‹å¦‚ï¼šæ¯è¦ª / çˆ¶è¦ª" data-en-ph="e.g., Mother / Father" placeholder="ä¾‹å¦‚ï¼šæ¯è¦ª">
                            </div>
                            <div class="border-t pt-4">
                                <p class="text-sm text-gray-500 mb-2" data-zh="å­¸ç”Ÿè¯çµ¡è³‡æ–™" data-en="Student Contact">å­¸ç”Ÿè¯çµ¡è³‡æ–™</p>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-zh="å­¸ç”Ÿå§“å *" data-en="Student Name *">å­¸ç”Ÿå§“å *</label>
                                <input type="text" id="child_name" name="child_name"
                                    class="w-full p-3 mb-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                    data-zh-ph="ä¾‹å¦‚ï¼šç‹å°æ˜" data-en-ph="e.g., David Wang" placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜">
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-zh="å­¸ç”Ÿé›»å­éƒµä»¶ *" data-en="Student Email *">å­¸ç”Ÿé›»å­éƒµä»¶ *</label>
                                <input type="email" id="child_email" name="child_email"
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                    data-zh-ph="ä¾‹å¦‚ï¼šdavid@example.com" data-en-ph="e.g., david@example.com" placeholder="ä¾‹å¦‚ï¼šdavid@example.com">
                            </div>
                        </div>
                    </div>

                    <!-- å­¸è¡“èƒŒæ™¯ -->
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <div class="flex items-center mb-2">
                                <span class="w-6 h-6 bg-yellow-400 text-gray-800 rounded-full flex items-center justify-center text-sm mr-2">2</span>
                                <span data-zh="å­¸è¡“èƒŒæ™¯" data-en="Academic Background">å­¸è¡“èƒŒæ™¯</span>
                            </div>
                        </h3>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-zh="GPA (æ»¿åˆ†4.0) *" data-en="GPA (out of 4.0) *">GPA (æ»¿åˆ†4.0) *</label>
                            <input type="number" id="gpa" name="gpa" step="0.1" min="0" max="4" required 
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                data-zh-ph="ä¾‹å¦‚ï¼š3.8" data-en-ph="e.g., 3.8" placeholder="ä¾‹å¦‚ï¼š3.8">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-zh="ç›®æ¨™å­¸ä½ *" data-en="Target Degree *">ç›®æ¨™å­¸ä½ *</label>
                            <select id="degree" name="degree" required 
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
                                <option value="" data-zh="è«‹é¸æ“‡" data-en="Please select">è«‹é¸æ“‡</option>
                                <option value="bachelor" data-zh="å­¸å£«" data-en="Bachelor's">å­¸å£«</option>
                                <option value="master" data-zh="ç¢©å£«" data-en="Master's">ç¢©å£«</option>
                                <option value="phd" data-zh="åšå£«" data-en="PhD">åšå£«</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-zh="ç›®æ¨™åœ‹å®¶ *" data-en="Target Countries *">ç›®æ¨™åœ‹å®¶ *</label>
                            <div class="flex flex-wrap gap-2">
                                <label class="flex items-center">
                                    <input type="checkbox" name="countries" value="us" class="mr-2">
                                    <span data-zh="ç¾åœ‹" data-en="USA">ç¾åœ‹</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="countries" value="uk" class="mr-2">
                                    <span data-zh="è‹±åœ‹" data-en="UK">è‹±åœ‹</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="countries" value="ca" class="mr-2">
                                    <span data-zh="åŠ æ‹¿å¤§" data-en="Canada">åŠ æ‹¿å¤§</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- é ç®—å’Œæ™‚é–“ -->
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <div class="flex items-center mb-2">
                                <span class="w-6 h-6 bg-yellow-400 text-gray-800 rounded-full flex items-center justify-center text-sm mr-2">3</span>
                                <span data-zh="é ç®—å’Œæ™‚é–“" data-en="Budget and Time">é ç®—å’Œæ™‚é–“</span>
                            </div>
                        </h3>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-zh="é ç®— (æ¯å¹´å­¸è²»+ç”Ÿæ´»è²»ï¼Œå–®ä½ï¼šç¾å…ƒ) *" data-en="Budget (Annual tuition + living expenses, USD) *">é ç®— (æ¯å¹´å­¸è²»+ç”Ÿæ´»è²»ï¼Œå–®ä½ï¼šç¾å…ƒ) *</label>
                            <input type="number" id="budget" name="budget" required 
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                data-zh-ph="ä¾‹å¦‚ï¼š50000" data-en-ph="e.g., 50000" placeholder="ä¾‹å¦‚ï¼š50000">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-zh="ç›®æ¨™å…¥å­¸æ™‚é–“ *" data-en="Target Intake Time *">ç›®æ¨™å…¥å­¸æ™‚é–“ *</label>
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                                <select id="intake_semester" name="intake_semester" required 
                                    class="w-full sm:w-1/3 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
                                    <option value="" data-zh="é¸æ“‡å­¸æœŸ" data-en="Select Semester">é¸æ“‡å­¸æœŸ</option>
                                    <option value="fall" data-zh="ç§‹å­£" data-en="Fall">ç§‹å­£</option>
                                    <option value="spring" data-zh="æ˜¥å­£" data-en="Spring">æ˜¥å­£</option>
                                    <option value="summer" data-zh="å¤å­£" data-en="Summer">å¤å­£</option>
                                    <option value="winter" data-zh="å†¬å­£" data-en="Winter">å†¬å­£</option>
                                </select>
                                <select id="intake_year" name="intake_year" required 
                                    class="w-full sm:w-2/3 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
                                    <option value="" data-zh="é¸æ“‡å¹´ä»½" data-en="Select Year">é¸æ“‡å¹´ä»½</option>
                                </select>
                            </div>
                            <input type="hidden" id="target_intake" name="target_intake">
                        </div>
                    </div>

                    <!-- è§’è‰²é¸æ“‡ -->
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <div class="flex items-center mb-2">
                                <span class="w-6 h-6 bg-yellow-400 text-gray-800 rounded-full flex items-center justify-center text-sm mr-2">4</span>
                                <span data-zh="é¸æ“‡æ‚¨çš„èº«ä»½" data-en="Choose Your Role">é¸æ“‡æ‚¨çš„èº«ä»½</span>
                            </div>
                        </h3>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                            <button type="button" onclick="selectRole('student')" id="role-student" 
                                    class="flex-1 px-4 sm:px-6 py-3 bg-blue-500 text-white rounded-lg font-medium transition-colors text-sm sm:text-base">
                                <span data-zh="ğŸ‘¨â€ğŸ“ æˆ‘æ˜¯å­¸ç”Ÿ" data-en="ğŸ‘¨â€ğŸ“ I am a Student">ğŸ‘¨â€ğŸ“ æˆ‘æ˜¯å­¸ç”Ÿ</span>
                            </button>
                            <button type="button" onclick="selectRole('parent')" id="role-parent" 
                                    class="flex-1 px-4 sm:px-6 py-3 bg-gray-300 text-gray-700 rounded-lg font-medium transition-colors hover:bg-gray-400 text-sm sm:text-base">
                                <span data-zh="ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ æˆ‘æ˜¯å®¶é•·" data-en="ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ I am a Parent">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ æˆ‘æ˜¯å®¶é•·</span>
                            </button>
                        </div>
                    </div>

                    <button type="submit" 
                            class="w-full bg-yellow-400 text-gray-800 py-3 px-6 rounded-lg font-medium hover:bg-yellow-500 transition-colors duration-200 text-lg shadow-lg"
                            data-zh="é–‹å§‹èˆ‡AIé¡§å•å°è©±" data-en="Start Chat with AI Advisor">
                        é–‹å§‹èˆ‡AIé¡§å•å°è©±
                    </button>
                </form>
            </main>
        </div>
    </div>

    <!-- èŠå¤©é é¢ -->
    <div id="chat-page" class="min-h-screen hidden">
        <div class="max-w-4xl mx-auto bg-white min-h-screen flex flex-col">
            <header class="bg-gradient-to-r from-yellow-400 to-yellow-300 text-gray-800 p-4 text-center relative">
                <button id="back-to-setup" class="absolute left-4 top-4 text-gray-800 hover:text-gray-600 transition-colors">
                    â† é‡æ–°è¨­å®š
                </button>
                <h1 class="text-xl font-bold">AI ç•™å­¸é¡§å•</h1>
                <p class="text-sm">æ­£åœ¨ç‚ºæ‚¨æä¾›å°ˆæ¥­å»ºè­°</p>
                <div class="flex items-center justify-center mt-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                    <span class="text-sm">åœ¨ç·š</span>
                </div>
            </header>

            <main class="flex-1 p-4 overflow-y-auto bg-gray-50" id="chat-container">
                <div class="space-y-4">
                    <div class="flex items-start space-x-3">
                        <div class="message-avatar avatar-ai">AI</div>
                        <div class="message-bubble message-ai">
                            <p>æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„AIç•™å­¸é¡§å•ã€‚æˆ‘å·²ç¶“äº†è§£äº†æ‚¨çš„åŸºæœ¬è³‡è¨Šï¼Œç¾åœ¨è®“æˆ‘å€‘æ·±å…¥è¨è«–æ‚¨çš„ç•™å­¸è¨ˆåŠƒå§ï¼</p>
                            <p class="mt-2">æ‚¨å¯ä»¥å•æˆ‘ä»»ä½•é—œæ–¼ç•™å­¸çš„å•é¡Œï¼Œæ¯”å¦‚ï¼š</p>
                            <ul class="mt-2 list-disc list-inside text-sm">
                                <li>æ¨è–¦é©åˆçš„å­¸æ ¡å’Œå°ˆæ¥­</li>
                                <li>ç”³è«‹æµç¨‹å’Œæ™‚é–“è¦åŠƒ</li>
                                <li>çå­¸é‡‘ç”³è«‹å»ºè­°</li>
                                <li>ç°½è­‰å’Œä½å®¿è³‡è¨Š</li>
                            </ul>
                            <div class="message-time">å‰›å‰›</div>
                        </div>
                    </div>
                </div>
            </main>

            <footer class="p-3 sm:p-4 border-t border-gray-200">
                <div id="quick-actions" class="flex flex-wrap gap-2 mb-3"></div>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                    <input type="text" id="message-input" 
                           class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-sm sm:text-base"
                           placeholder="è«‹è¼¸å…¥æ‚¨çš„å•é¡Œ...">
                    <button id="send-btn" 
                            class="px-4 sm:px-6 py-3 bg-yellow-400 text-gray-800 rounded-lg font-medium hover:bg-yellow-500 transition-colors text-sm sm:text-base"
                            data-zh="ç™¼é€" data-en="Send">ç™¼é€</button>
                </div>
                <p class="text-xs text-gray-500 mt-2 text-center" data-zh="æŒ‰ Enter ç™¼é€" data-en="Press Enter to send">æŒ‰ Enter ç™¼é€</p>
            </footer>
        </div>
    </div>

    <script>
        // å…¨å±€è®Šé‡
        let currentRole = 'student';
        let currentLanguage = 'zh';
        let profileId = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å–å¾— Google Client ID ä»¥åˆå§‹åŒ– GIS
            fetch(`${window.__CONFIG__.API_BASE}/auth/config`)
                .then(r => r.json())
                .then(cfg => {
                    if (cfg && cfg.ok && cfg.googleClientId) {
                        window.__GOOGLE_CLIENT_ID__ = cfg.googleClientId;
                    }
                })
                .catch(() => {});
            // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
            checkAuthStatus();
            
            // åˆå§‹åŒ–å¹´ä»½é¸é …
            initializeYearOptions();
            
            // ç¶å®šäº‹ä»¶
            document.getElementById('back-to-home').addEventListener('click', showLoginPage);
            document.getElementById('back-to-setup').addEventListener('click', showSetupPage);
            document.getElementById('setup-form').addEventListener('submit', handleSetupSubmit);
            document.getElementById('send-btn').addEventListener('click', sendMessage);
            document.getElementById('message-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // ç¶å®šæ—¥æœŸé¸æ“‡äº‹ä»¶
            document.getElementById('intake_semester').addEventListener('change', updateTargetIntake);
            document.getElementById('intake_year').addEventListener('change', updateTargetIntake);
        });

        // æª¢æŸ¥èªè­‰ç‹€æ…‹
        async function checkAuthStatus() {
            try {
                const response = await fetch(`${window.__CONFIG__.API_BASE}/auth/status`);
                const data = await response.json();
                
                if (data.ok && data.user) {
                    showUserInfo(data.user);
                } else {
                    showLoginButtons();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                showLoginButtons();
            }
        }

        // é¡¯ç¤ºç”¨æˆ¶è³‡è¨Š
        function showUserInfo(user) {
            document.getElementById('user-info').classList.remove('hidden');
            document.getElementById('login-buttons').classList.add('hidden');
            document.getElementById('user-name').textContent = user.name;
            if (user.avatar) {
                document.getElementById('user-avatar').src = user.avatar;
            }
        }

        // é¡¯ç¤ºç™»å…¥æŒ‰éˆ•
        function showLoginButtons() {
            document.getElementById('user-info').classList.add('hidden');
            document.getElementById('login-buttons').classList.remove('hidden');
        }

        // ç™»å…¥åŠŸèƒ½
        function loginWithGoogle() {
            if (!window.__GOOGLE_CLIENT_ID__) {
                alert(currentLanguage === 'en' ? 'Google login is not ready.' : 'Google ç™»å…¥å°šæœªå°±ç·’');
                return;
            }
            const client = google.accounts.oauth2.initTokenClient({
                client_id: window.__GOOGLE_CLIENT_ID__,
                scope: 'openid email profile',
                callback: async (response) => {
                    try {
                        const idToken = response.access_token ? undefined : undefined; // token client ä¸çµ¦ id_token
                    } catch (e) {}
                }
            });
            // æ”¹ç”¨ one-tap çš„ ID token API
            google.accounts.id.initialize({
                client_id: window.__GOOGLE_CLIENT_ID__,
                callback: async (resp) => {
                    try {
                        const idToken = resp.credential;
                        const r = await fetch(`${window.__CONFIG__.API_BASE}/auth/google/verify`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ idToken })
                        });
                        const data = await r.json();
                        if (data.ok && data.token) {
                            localStorage.setItem('jwt', data.token);
                            showUserInfo(data.user || { name: 'User' });
                            showSetupPage();
                        } else {
                            alert(currentLanguage === 'en' ? 'Login failed.' : 'ç™»å…¥å¤±æ•—');
                        }
                    } catch (err) {
                        alert(currentLanguage === 'en' ? 'Login failed.' : 'ç™»å…¥å¤±æ•—');
                    }
                }
            });
            google.accounts.id.prompt();
        }

        function loginWithLine() {
            alert(currentLanguage === 'en' ? 'Login is temporarily unavailable. Please click "Skip login, start directly".' : 'ç™»å…¥åŠŸèƒ½æš«æ™‚ä¸å¯ç”¨ï¼Œè«‹é»ã€Œè·³éç™»å…¥ï¼Œç›´æ¥é–‹å§‹ã€');
        }

        function logout() {
            window.location.href = `${window.__CONFIG__.API_BASE.replace('/api/v1', '')}/auth/logout`;
        }

        // è·³éç™»å…¥
        function skipLogin() {
            // å‰µå»ºä¸€å€‹å‡çš„ JWT token ç”¨æ–¼æ¸¬è©¦
            const fakeToken = 'fake-jwt-token-for-testing';
            localStorage.setItem('jwt', fakeToken);
            showSetupPage();
        }

        // åˆå§‹åŒ–å¹´ä»½é¸é …
        function initializeYearOptions() {
            const yearSelect = document.getElementById('intake_year');
            const currentYear = new Date().getFullYear();
            
            // ç”Ÿæˆæœªä¾† 5 å¹´çš„é¸é …
            for (let i = 0; i < 5; i++) {
                const year = currentYear + i;
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                option.setAttribute('data-zh', year);
                option.setAttribute('data-en', year);
                yearSelect.appendChild(option);
            }
        }

        // æ›´æ–°ç›®æ¨™å…¥å­¸æ™‚é–“
        function updateTargetIntake() {
            const semester = document.getElementById('intake_semester').value;
            const year = document.getElementById('intake_year').value;
            const targetIntakeInput = document.getElementById('target_intake');
            
            if (semester && year) {
                const semesterText = currentLanguage === 'en' 
                    ? semester.charAt(0).toUpperCase() + semester.slice(1)
                    : semester === 'fall' ? 'ç§‹å­£' : semester === 'spring' ? 'æ˜¥å­£' : semester === 'summer' ? 'å¤å­£' : 'å†¬å­£';
                
                const intakeText = currentLanguage === 'en' 
                    ? `${semesterText} ${year}`
                    : `${year}å¹´${semesterText}`;
                
                targetIntakeInput.value = intakeText;
            } else {
                targetIntakeInput.value = '';
            }
        }

        // èªè¨€åˆ‡æ›
        function switchLanguage(lang) {
            currentLanguage = lang;
            // æ›´æ–°æ‰€æœ‰å…·å‚™ data-zh / data-en çš„å…ƒç´ 
            const elements = document.querySelectorAll('[data-zh]');
            elements.forEach(el => {
                const text = el.getAttribute(`data-${currentLanguage}`);
                if (text) el.textContent = text;
            });
            // æ›´æ–° placeholder
            const inputs = document.querySelectorAll('[data-zh-ph]');
            inputs.forEach(input => {
                const placeholder = input.getAttribute(`data-${currentLanguage}-ph`);
                if (placeholder) input.placeholder = placeholder;
            });
            // æ›´æ–° select é¸é …
            const options = document.querySelectorAll('option[data-zh]');
            options.forEach(option => {
                const text = option.getAttribute(`data-${currentLanguage}`);
                if (text) option.textContent = text;
            });
            
            // æ›´æ–°ç›®æ¨™å…¥å­¸æ™‚é–“é¡¯ç¤º
            updateTargetIntake();
            // æ›´æ–°èªè¨€åˆ‡æ›æŒ‰éˆ•æ¨£å¼
            document.getElementById('lang-switch-zh').classList.toggle('bg-blue-500', lang === 'zh');
            document.getElementById('lang-switch-zh').classList.toggle('bg-gray-200', lang !== 'zh');
            document.getElementById('lang-switch-zh').classList.toggle('text-white', lang === 'zh');
            document.getElementById('lang-switch-zh').classList.toggle('text-gray-700', lang !== 'zh');
            document.getElementById('lang-switch-en').classList.toggle('bg-blue-500', lang === 'en');
            document.getElementById('lang-switch-en').classList.toggle('bg-gray-200', lang !== 'en');
            document.getElementById('lang-switch-en').classList.toggle('text-white', lang === 'en');
            document.getElementById('lang-switch-en').classList.toggle('text-gray-700', lang !== 'en');
        }

        // è§’è‰²é¸æ“‡
        function selectRole(role) {
            currentRole = role;
            document.getElementById('role-student').classList.toggle('bg-blue-500', role === 'student');
            document.getElementById('role-student').classList.toggle('bg-gray-300', role !== 'student');
            document.getElementById('role-parent').classList.toggle('bg-blue-500', role === 'parent');
            document.getElementById('role-parent').classList.toggle('bg-gray-300', role !== 'parent');

            // åˆ‡æ›æ¬„ä½é¡¯ç¤º
            document.getElementById('student-fields').classList.toggle('hidden', role !== 'student');
            document.getElementById('parent-fields').classList.toggle('hidden', role !== 'parent');
            loadQuickActions();
        }

        // é é¢åˆ‡æ›
        function showLoginPage() {
            document.getElementById('login-page').classList.remove('hidden');
            document.getElementById('setup-page').classList.add('hidden');
            document.getElementById('chat-page').classList.add('hidden');
        }

        function showSetupPage() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('setup-page').classList.remove('hidden');
            document.getElementById('chat-page').classList.add('hidden');
        }

        function showChatPage() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('setup-page').classList.add('hidden');
            document.getElementById('chat-page').classList.remove('hidden');
            loadQuickActions();
            // è‡ªå‹•ç™¼é€æ‰“æ‹›å‘¼è¨Šæ¯
            sendWelcomeMessage();
        }

        // è™•ç†è¨­å®šæäº¤
        async function handleSetupSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            let data = {};
            
            if (currentRole === 'student') {
                data = {
                    student_name: formData.get('student_name'),
                    student_email: formData.get('student_email'),
                    citizenship: formData.get('citizenship'),
                    gpa: parseFloat(formData.get('gpa')),
                    degree: formData.get('degree'),
                    countries: Array.from(document.querySelectorAll('input[name="countries"]:checked')).map(cb => cb.value),
                    budget: parseInt(formData.get('budget')),
                    target_intake: formData.get('target_intake'),
                    user_role: currentRole
                };
            } else {
                data = {
                    parent_name: formData.get('parent_name'),
                    parent_email: formData.get('parent_email'),
                    relationship: formData.get('relationship'),
                    child_name: formData.get('child_name'),
                    child_email: formData.get('child_email'),
                    gpa: parseFloat(formData.get('gpa')),
                    degree: formData.get('degree'),
                    countries: Array.from(document.querySelectorAll('input[name="countries"]:checked')).map(cb => cb.value),
                    budget: parseInt(formData.get('budget')),
                    target_intake: formData.get('target_intake'),
                    user_role: currentRole
                };
            }

            try {
                // æª¢æŸ¥æ˜¯å¦æœ‰ JWT token
                const jwt = localStorage.getItem('jwt');
                if (!jwt) {
                    alert(currentLanguage === 'en' ? 'Please login first or skip login to continue.' : 'è«‹å…ˆç™»å…¥æˆ–è·³éç™»å…¥ç¹¼çºŒ');
                    return;
                }
                
                const authHeader = { 'Authorization': `Bearer ${jwt}` };
                const response = await fetch(`${window.__CONFIG__.API_BASE}/intake`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...authHeader
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                if (result.ok) {
                    profileId = result.data.profile_id;
                    showChatPage();
                } else {
                    alert('æäº¤å¤±æ•—ï¼š' + result.error);
                }
            } catch (error) {
                console.error('Setup submission failed:', error);
                alert('æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥');
            }
        }

        // ç™¼é€æ¶ˆæ¯
        async function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            
            if (!message) return;

            // æ·»åŠ ç”¨æˆ¶æ¶ˆæ¯åˆ°èŠå¤©
            addMessage(message, 'user');
            input.value = '';

            try {
                const authHeader = localStorage.getItem('jwt') ? { 'Authorization': `Bearer ${localStorage.getItem('jwt')}` } : {};
                const response = await fetch(`${window.__CONFIG__.API_BASE}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...authHeader
                    },
                    body: JSON.stringify({
                        profile_id: profileId,
                        message: message,
                        user_role: currentRole,
                        language: currentLanguage
                    })
                });

                const result = await response.json();
                
                if (result.ok) {
                    addMessage(result.data.response, 'ai');
                } else {
                    addMessage('æŠ±æ­‰ï¼Œæˆ‘ç„¡æ³•è™•ç†æ‚¨çš„è«‹æ±‚ã€‚è«‹ç¨å¾Œå†è©¦ã€‚', 'ai');
                }
            } catch (error) {
                console.error('Chat failed:', error);
                addMessage('æŠ±æ­‰ï¼Œç¶²è·¯é€£æ¥å‡ºç¾å•é¡Œã€‚è«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯é€£æ¥ã€‚', 'ai');
            }
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©
        function addMessage(message, sender) {
            const chatContainer = document.getElementById('chat-container');
            const messageWrapper = document.createElement('div');
            
            const currentTime = new Date().toLocaleTimeString('zh-TW', { 
                hour: '2-digit', 
